---
title: "Filmes by Rodrigo Santoro"
author: "Paulo Vinicius Soares"
date: "16 de junho de 2017"
output: 
  html_document:
        toc: true
        toc_float: true
        toc_depth: 3
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
# Imports
library(tidyverse, warn.conflicts = F)
library(rvest)
library(plotly)
library(cluster)
library(ggdendro)
library(fpc)
source("plota_solucoes_hclust.R")
```

Olá! Este texto é uma continuação das análises referentes à disciplina de Análise de Dados I, na Universidade Federal de Campina Grande (UFCG). Na análise de hoje iremos abordar os filmes estrelados por **Rodrigo Santoro**, artista brasileiro de grande reconhecimento internacional atuando como galã de vários filmes e com um currículo de dar inveja em qualquer ator.

Nesta análise utilizaremos **duas variáveis** para traçar perfis dos filmes estrelados por Rodrigo. Estas variáveis são o **Box Office** e **Rating**, que apontam para a bilheteria que o filme arrecadou e avaliação pelo público, respectivamente.

Vamos visualizar abaixo os filmes representados por pontos em um gráfico que demonstra a relação entre a bilheteria do filme e sua avaliação pelo público.

```{r}
from_page <- read_html("https://www.rottentomatoes.com/celebrity/rodrigo_santoro/") %>% 
    html_node("#filmographyTbl") %>% # A sintaxe da expressão é de um seletor à lá JQuery: https://rdrr.io/cran/rvest/man/html_nodes.html 
    html_table(fill=TRUE) %>% # Faz parse
    as.tibble()

filmes = from_page %>% 
    filter(RATING != "No Score Yet", 
           `BOX OFFICE` != "—", 
           CREDIT != "Executive Producer") %>%
    mutate(RATING = as.numeric(gsub("%", "", RATING)), 
           `BOX OFFICE` = as.numeric(gsub("[$|M]", "", `BOX OFFICE`))) %>% 
    filter(`BOX OFFICE` >= 1) 
```

```{r}
# Utilizando o Ward Hierarchical Clustering

agrupamento_h_2d = filmes %>% 
    column_to_rownames("TITLE") %>%
    select(RATING, `BOX OFFICE`) %>%
    dist(method = "euclidean") %>% 
    hclust(method = "centroid")

ggdendrogram(agrupamento_h_2d, rotate = TRUE)

data.frame(k = NROW(agrupamento_h_2d$height):1, 
           height = agrupamento_h_2d$height) %>% 
    ggplot(aes(x = k, y = height)) + 
    geom_line(colour = "grey") + 
    geom_point() + 
    labs(x = "Número de clusters produzido", y = "Dissimilaridade na junção")

plota_hclusts_2d(agrupamento_h_2d, 
                 filmes, 
                 c("RATING", "`BOX OFFICE`"), 
                 linkage_method = "centroid", ks = 1:6)
```

Agora, utilizando uma técnica chamada **agrupamento** vamos criar blocos que englobam vários filmes atribuindo-lhe uma categoria. 

# As categorias iremos nomear de acordo com a posição desses grupos no gráfico, assim podemos ter noção dos babados.

# Pelo que eu lembro da análise, acho que havia 5 ou 6 grupos coerentes, real. Então assim, é bacana nomear os agrupamentos em ordem crescente nos dois eixos:
# Filmes de muita bilheteria, porém não muito sucesso com o público e por aí vai, sendo que as categorias tem que ser mais específicas.

